.markdown-content {
  width: 100%;
  overflow-wrap: break-word;
  word-wrap: break-word;
  word-break: break-word;
  line-height: 1.4;
  /* Ensure tables can scroll horizontally within the container */
  min-width: 0;
}

/* 
 * Link styling with WCAG AA compliant contrast ratios
 * Light mode: #2563eb - Passes contrast check against white background
 * Dark mode: #93c5fd - Passes contrast check against dark backgrounds
 */
.markdown-content a {
  color: var(--text-link);
  text-decoration: underline;
  font-weight: 500;
  transition: color 0.2s ease;
}

.markdown-content a:hover {
  opacity: 0.85;
}

/* 
 * Using class selector instead of media query for dark mode
 * This ensures it works correctly with the app's theme system
 */
.dark .markdown-content a {
  color: var(--text-link);
}

.dark .markdown-content a:hover {
  opacity: 0.85;
}

/* Basic text styles with improved readability */
.markdown-content p {
  margin: 0.5em 0;
  line-height: 1.5;
  color: var(--foreground);
}

/* Ensure bullets and numbers are visible regardless of global styles */
.markdown-content ul {
  list-style-type: disc;
  list-style-position: outside;
  padding-left: 1.5em;
}

.markdown-content ol {
  list-style-type: decimal;
  list-style-position: outside;
  padding-left: 1.5em;
}

/* Ensure list items render with markers */
.markdown-content li {
  display: list-item;
}

/* Inline code container styles */
.inline-code-container {
  position: relative;
  display: inline-flex;
  align-items: stretch;
  max-width: 100%;
  background-color: var(--more-muted);
  border: 1px solid var(--border);
  border-radius: 3px;
  overflow: hidden;
}

/* Inline code styling */
.markdown-content :not(pre) > code,
.inline-code-container > code {
  display: inline;
  padding: 2px 4px;
  font-family: "Courier New", monospace;
  font-size: 0.9em;
  white-space: normal;
  color: var(--foreground);
  background-color: transparent;
  border: none;
  border-radius: 0;
}

/* Dark mode specific inline code styling */
.dark .inline-code-container {
  border-color: var(--border);
}

.dark .markdown-content :not(pre) > code,
.dark .inline-code-container > code {
  color: var(--accent-foreground);
}

/* Inline code copy button */
.inline-copy-button {
  position: relative;
  top: 0;
  margin-left: 0;
  background: var(--primary);
  color: var(--primary-foreground);
  border: none;
  border-radius: 0 2px 2px 0;
  padding-left: 4px;
  padding-right: 4px;
  width: auto;
  font-size: 10px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
  border-left: 1px solid var(--border);
}

.inline-copy-button:hover {
  opacity: 0.9;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

/* Focus styles for accessibility */
.inline-copy-button:focus-visible {
  outline: 2px solid var(--ring);
  outline-offset: 2px;
}

.inline-copy-button svg {
  width: 10px;
  height: 10px;
}

/* List styling with improved spacing */
.markdown-content ul,
.markdown-content ol {
  padding-left: 2em;
  margin: 0.8em 0;
  color: var(--foreground);
  list-style-position: outside;
}

.markdown-content ul {
  list-style-type: disc;
}

.markdown-content ol {
  list-style-type: decimal;
}

.markdown-content li {
  margin: 0.4em 0;
  line-height: 1.5;
  display: list-item;
}

.markdown-content li > p {
  margin: 0;
  padding: 0;
  display: inline;
}

/* Ensure that ordered and unordered lists have correct spacing */
.markdown-content ol,
.markdown-content ul {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
  padding-left: 1.5em;
}

/* Enhanced list styling to fix bullet rendering issues */
.markdown-list {
  margin: 0.8em 0;
  padding-left: 1.5em;
  color: var(--foreground);
}

.markdown-ul {
  list-style-type: disc;
  list-style-position: outside;
}

.markdown-ol {
  list-style-type: decimal;
  list-style-position: outside;
}

/* Fix for iOS list rendering */
@supports (-webkit-touch-callout: none) {
  .markdown-ul {
    list-style-type: disc !important;
    -webkit-padding-start: 1.5em;
  }

  .markdown-ol {
    list-style-type: decimal !important;
    -webkit-padding-start: 1.5em;
  }

  .markdown-list-item {
    display: list-item !important;
    list-style: inherit !important;
  }
}

/* Nested list support */
.markdown-list .markdown-list {
  margin: 0.2em 0;
  padding-left: 1.2em;
}

.markdown-ul .markdown-ul {
  list-style-type: circle;
}

.markdown-ul .markdown-ul .markdown-ul {
  list-style-type: square;
}

/* Image container styling */
.image-container {
  display: flex;
  justify-content: center;
  align-items: center;
  margin: 8px 0;
  border-radius: 4px;
  overflow: hidden;
  position: relative;
}

/* Special placeholder styling for image containers on iOS */
@supports (-webkit-touch-callout: none) {
  .image-container {
    border: 1px solid rgba(0, 0, 0, 0.1);
    background: rgba(0, 0, 0, 0.05);
  }

  .dark .image-container {
    border: 1px solid rgba(255, 255, 255, 0.1);
    background: rgba(0, 0, 0, 0.2);
  }
}

.markdown-image {
  max-width: 100%;
  max-height: 300px;
  border-radius: 4px;
  cursor: pointer;
  transition: transform 0.2s ease;
  display: block; /* Prevents inline spacing issues */

  /* Add GPU acceleration and rendering optimizations */
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
}

/* Simpler iOS fixes that don't break interactivity */
@supports (-webkit-touch-callout: none) {
  .markdown-image {
    /* Basic GPU acceleration to prevent repaints */
    -webkit-transform: translateZ(0);
    transform: translateZ(0);
    /* Make images more responsive to taps */
    -webkit-tap-highlight-color: transparent;
  }

  /* Ensure image container is stable */
  .image-container {
    min-height: 100px; /* Simple minimum height */
  }
}

.markdown-image:hover {
  transform: scale(1.02);
}

/* Code block wrapper styling */
.code-block-wrapper {
  position: relative;
  margin: 12px 0;
  width: 100%;
  display: block;
  border-radius: 6px;
  overflow: hidden;
  background-color: var(--more-muted);
}

.code-container {
  width: 100%;
  overflow-x: auto; /* Enable horizontal scrolling */
  display: block !important; /* Override inline code display property */
  border-radius: 6px;
  scrollbar-width: thin;
  scrollbar-color: var(--scrollbar-thumb-color) transparent;
  background-color: var(--more-muted);
}

/* Fix for iOS code block font size */
@supports (-webkit-touch-callout: none) {
  /* Apply more specific selectors to override any inherited styles */
  .code-container pre,
  .code-container code,
  .code-container pre code,
  .markdown-content pre,
  .markdown-content pre code,
  .markdown-content .code-block,
  .markdown-content .code-container * {
    -webkit-text-size-adjust: none !important; /* Prevent iOS text size adjustment */
    max-height: none !important; /* Prevent height restrictions */
  }

  /* Target SyntaxHighlighter specifically */
  .code-container .react-syntax-highlighter,
  .code-container .react-syntax-highlighter code,
  .code-container .react-syntax-highlighter pre {
    line-height: 1.4 !important;
  }
}

/* 
 * Custom scrollbar for WebKit browsers with improved contrast
 * Uses theme variables for consistent styling across light and dark modes
 */
.code-container::-webkit-scrollbar {
  height: 6px;
}

.code-container::-webkit-scrollbar-track {
  background: transparent;
}

.code-container::-webkit-scrollbar-thumb {
  background-color: var(--scrollbar-thumb-color);
  border-radius: 6px;
}

.code-container::-webkit-scrollbar-thumb:hover {
  background-color: var(--scrollbar-thumb-hover-color);
}

/* Button container to keep it fixed in position */
.copy-button-container {
  position: absolute;
  top: 8px;
  right: 8px;
  z-index: 10;
}

/* Override SyntaxHighlighter styles for horizontal scrolling */
.code-container pre {
  white-space: pre !important; /* Ensure pre preserves whitespace */
  overflow-x: visible !important; /* Let parent container handle scrolling */
  min-width: min-content; /* Ensure content takes at least its minimum width */
  display: block !important;
}

/* SyntaxHighlighter renders multiple nested divs, ensure they don't interfere with scrolling */
.code-container > div {
  min-width: min-content !important; /* Ensure content doesn't shrink below its natural width */
  max-width: none !important; /* Let parent container constrain width */
  overflow: visible !important; /* Let the parent container handle scrolling */
}

/* Ensure SyntaxHighlighter displays as block */
.markdown-content pre {
  display: block;
  margin: 0.5em 0;
  padding: 0;
}

/* 
 * Code block styling with improved WCAG AA compliant contrast
 * Darker background with higher contrast text for better readability
 */
.markdown-content pre code {
  display: block;
  white-space: pre;
  padding: 1em;
  border-radius: 6px;
  line-height: 1.5;
  /* Override syntax highlighter inline styles */
  background: var(--more-muted) !important;
  background-color: var(--more-muted) !important;
}

/* 
 * Code block copy button with WCAG AA compliant contrast
 * Uses the primary color with white text for good contrast (>4.5:1 ratio)
 */
.copy-button {
  background: var(--primary);
  color: var(--primary-foreground);
  border: none;
  border-radius: 6px;
  padding: 6px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.copy-button:hover {
  opacity: 0.9;
  transform: translateY(-1px);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

/* Focus styles for accessibility */
.copy-button:focus-visible {
  outline: 2px solid var(--ring);
  outline-offset: 2px;
}

/* Make headings more readable with consistent contrast */
.markdown-content h1,
.markdown-content h2,
.markdown-content h3,
.markdown-content h4,
.markdown-content h5,
.markdown-content h6 {
  color: var(--foreground);
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

/* Enhance blockquote styling for better light mode visibility */
.markdown-content blockquote {
  border-left: 4px solid var(--border-strong);
  padding-left: 1rem;
  margin-left: 0;
  margin-right: 0;
  color: var(--muted-foreground);
  font-style: italic;
}

/* Table styling with enhanced borders */
.table-wrapper {
  width: 100%;
  max-width: 100%;
  overflow-x: auto;
  margin: 1rem 0;
  border-radius: 8px;
  border: 2px solid var(--border);
  background-color: var(--card);
  /* Enhanced accessibility */
  -webkit-overflow-scrolling: touch;
  scroll-behavior: smooth;
  /* Add subtle shadow for better definition */
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  /* Force the container to respect width constraints */
  min-width: 0;
  box-sizing: border-box;
}

/* Focus management for keyboard navigation */
.table-wrapper:focus {
  outline: 2px solid var(--ring);
  outline-offset: 2px;
}

.table-wrapper:focus-visible {
  outline: 2px solid var(--ring);
  outline-offset: 2px;
}

.markdown-table {
  width: 100%;
  min-width: max-content;
  border-collapse: collapse;
  font-size: 0.9em;
  line-height: 1.5;
  color: var(--foreground);
  background-color: var(--card);
  /* Ensure proper table semantics for screen readers */
  border-spacing: 0;
  /* Prevent table from shrinking smaller than its content */
  table-layout: auto;
}

.markdown-table-head {
  background-color: var(--muted);
  border-bottom: 3px solid var(--border);
}

.markdown-table-header {
  padding: 12px 16px;
  text-align: left;
  font-weight: 600;
  color: var(--foreground);
  background-color: var(--muted);
  border-bottom: 2px solid var(--border);
  border-right: 2px solid var(--border);
  white-space: nowrap;
  min-width: 120px;
  /* Enhanced accessibility for header cells */
  position: relative;
  /* Prevent header text from wrapping */
  text-overflow: ellipsis;
}

.markdown-table-header:last-child {
  border-right: none;
}

/* Focus styles for interactive table elements */
.markdown-table-header:focus,
.markdown-table-cell:focus {
  outline: 2px solid var(--ring);
  outline-offset: -2px;
  position: relative;
  z-index: 1;
}

.markdown-table-body {
  background-color: var(--card);
}

.markdown-table-row {
  border-bottom: 1px solid var(--border);
  transition: background-color 0.2s ease;
}

.markdown-table-row:hover {
  background-color: var(--muted/50);
}

.markdown-table-row:last-child {
  border-bottom: none;
}

.markdown-table-cell {
  padding: 12px 16px;
  border-right: 1px solid var(--border);
  vertical-align: top;
  word-wrap: break-word;
  max-width: 200px;
  min-width: 100px;
  /* Allow content to wrap but maintain minimum width for horizontal scrolling */
}

.markdown-table-cell:last-child {
  border-right: none;
}

/* Inline code styling within table cells */
.markdown-table-cell code.inline-code,
.markdown-table-header code.inline-code {
  background-color: var(--more-muted);
  border: 1px solid var(--border);
  border-radius: 3px;
  padding: 2px 4px;
  font-family: "Courier New", monospace;
  font-size: 0.9em;
  color: var(--foreground);
}

/* Bold and italic text within tables */
.markdown-table-cell strong,
.markdown-table-header strong {
  font-weight: 600;
  color: var(--foreground);
}

.markdown-table-cell em,
.markdown-table-header em {
  font-style: italic;
  color: var(--foreground);
}

/* Links within tables */
.markdown-table-cell a,
.markdown-table-header a {
  color: var(--text-link);
  text-decoration: underline;
  font-weight: 500;
}

/* Enhanced responsive table styling for mobile */
@media (max-width: 768px) {
  .table-wrapper {
    font-size: 0.8em;
    /* Improve touch scrolling on mobile */
    -webkit-overflow-scrolling: touch;
    scroll-snap-type: x mandatory;
  }

  .markdown-table-header,
  .markdown-table-cell {
    padding: 8px 12px;
    min-width: 100px;
    /* Better touch targets */
    min-height: 44px;
  }

  .markdown-table-cell {
    max-width: 150px;
  }

  /* Larger focus indicators on mobile */
  .table-wrapper:focus,
  .table-wrapper:focus-visible {
    outline-width: 3px;
  }
}

/* Improved mobile accessibility */
@media (max-width: 480px) {
  .markdown-table-header,
  .markdown-table-cell {
    padding: 6px 8px;
    min-width: 80px;
    font-size: 0.9em;
  }
}

/* Dark mode specific table styling with enhanced borders */
.dark .markdown-table {
  border-color: var(--border);
}

.dark .markdown-table-head {
  background-color: var(--muted);
}

.dark .markdown-table-header {
  background-color: var(--muted);
  color: var(--foreground);
  border-color: var(--border);
}

.dark .markdown-table-row:hover {
  background-color: var(--muted/30);
}

.dark .markdown-table-cell {
  border-color: var(--border);
}

.dark .table-wrapper {
  border-color: var(--border);
  box-shadow: 0 1px 3px rgba(255, 255, 255, 0.1);
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  .markdown-table {
    border: 2px solid var(--foreground);
  }

  .markdown-table-header,
  .markdown-table-cell {
    border: 1px solid var(--foreground);
  }

  .markdown-table-row:hover {
    background-color: var(--foreground);
    color: var(--background);
  }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  .markdown-table-row {
    transition: none;
  }

  .table-wrapper {
    scroll-behavior: auto;
  }
}

/* Ensure tables don't break the layout */
.markdown-content .table-wrapper {
  max-width: 100%;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  /* Force containment within chat bubble */
  min-width: 0;
  box-sizing: border-box;
  /* Override parent word-breaking for tables */
  word-break: normal;
  overflow-wrap: normal;
}

/* Fallback: make raw tables horizontally scrollable within the bubble */
.markdown-content table {
  display: block;
  max-width: 100%;
  width: max-content; /* allow table to exceed bubble width so scrolling engages */
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  border-collapse: collapse;
}

/* Consolidated scrollbar styles for better performance */
.table-wrapper::-webkit-scrollbar,
.code-container::-webkit-scrollbar {
  height: 6px;
}

.table-wrapper::-webkit-scrollbar-track,
.code-container::-webkit-scrollbar-track {
  background: transparent;
}

.table-wrapper::-webkit-scrollbar-thumb,
.code-container::-webkit-scrollbar-thumb {
  background-color: var(--scrollbar-thumb-color);
  border-radius: 3px;
}

.table-wrapper::-webkit-scrollbar-thumb:hover,
.code-container::-webkit-scrollbar-thumb:hover {
  background-color: var(--scrollbar-thumb-hover-color);
}
